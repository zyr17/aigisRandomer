<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Aigis单位随机器Demo</title>
        <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
        <script src="http://libs.baidu.com/jquery/2.1.1/jquery.js"></script>
        <script src="https://vuejs.org/js/vue.js"></script>
        <script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
        
        <!-- a.wheel-button: old: get href attr; new: get bindwheel attr. -->
        <script src="http://t.zyr17.cn/js/jquery.wheelmenu.js"></script>
        
        <script src="aigisRandomer.js"></script>
        <link rel="stylesheet" href="aigisRandomer.css">
    </head>
    <body>
    <div>
        <div id="navidiv">
            <div id="rarediv">
                <span class="buttontitle">稀有度</span>
                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="navichosen">全部</span> <span class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="javascript:void(0)">全部</a></li>
                        <li><a href="javascript:void(0)">蓝</a></li>
                        <li><a href="javascript:void(0)">黑</a></li>
                        <li><a href="javascript:void(0)">白</a></li>
                        <li><a href="javascript:void(0)">金</a></li>
                        <li><a href="javascript:void(0)">银</a></li>
                        <li><a href="javascript:void(0)">铜</a></li>
                        <li><a href="javascript:void(0)">铁</a></li>
                    </ul>
                </div>
            </div>
            <div id="positiondiv">
                <span class="buttontitle">位置</span>
                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="navichosen">全部</span> <span class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="javascript:void(0)">全部</a></li>
                        <li><a href="javascript:void(0)">近战</a></li>
                        <li><a href="javascript:void(0)">远程</a></li>
                    </ul>
                </div>
            </div>
            <div id="chosendiv">
                <span class="buttontitle">已选</span>
                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="navichosen">全部</span> <span class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="javascript:void(0)">全部</a></li>
                        <li><a href="javascript:void(0)">未选</a></li>
                        <li><a href="javascript:void(0)">已选</a></li>
                    </ul>
                </div>
            </div>
            <div id="costdiv">
                <span class="buttontitle">COST</span>
                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="navichosen">全部</span> <span class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="javascript:void(0)">全部</a></li>
                        <li><a href="javascript:void(0)">低(0-15)</a></li>
                        <li><a href="javascript:void(0)">中(16-25)</a></li>
                        <li><a href="javascript:void(0)">高(26-?)</a></li>
                    </ul>
                </div>
            </div>
            <div id="sortdiv">
                <span class="buttontitle">排序方式</span>
                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="navichosen">名称</span> <span class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="javascript:void(0)">名称</a></li>
                        <li><a href="javascript:void(0)">稀有度</a></li>
                        <li><a href="javascript:void(0)">职业</a></li>
                        <li><a href="javascript:void(0)">COST</a></li>
                    </ul>
                </div>
            </div>
            <div id="searchdiv" class="input-group">
                <input type="text" id="searchinput" class="form-control">
                <span class="input-group-btn">
                    <button id="searchbutton" class="btn btn-default" type="button">搜索</button>
                </span>
            </div>
            <div>
                <button id="randombutton" class="btn btn-default" type="button">随机</button>
            </div>
        </div>
        <div id="navipadding"></div>
        <div id="unitlistdiv">
            <div style="display: flex; flex-direction: column;">
                <div style="display: flex; justify-content: center; flex: none;">
                    <span style="margin: 10px; flex: none; font-size: 30px; font-weight: bold;">
                        数据载入中...(实际上应该是使用说明)
                    </span>
                </div>
                <div style="flex: none; display: flex; justify-content: center;">
                    <span style="flex: none;">
                        <input id="notwelcome" type="checkbox"/>自动跳过
                    </span>
                    <button id="initbutton" type="button" disabled="disabled">数据载入中...</button>
                </div>
            </div>
        </div>
        <div id="footerdiv">
            <button type="button" class="btn btn-default" id="savedata" href="javascript:void(0)" data-toggle="modal" data-target="#savemodal">保存</button>
            <button type="button" class="btn btn-default" href="javascript:void(0)" data-toggle="modal" data-target="#loadmodal">加载</button>
        </div>
        <div id="footerpadding"></div>
        <div class="modal fade" id="savemodal" tabindex="-1" role="dialog" aria-labelledby="savemodallabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="savemodallabel">请保存下面的数据</h4>
                    </div>
                    <div class="modal-body">
                        <textarea id="savemodaltextarea" readonly="readonly" onclick="this.focus();this.select();"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="loadmodal" tabindex="-1" role="dialog" aria-labelledby="loadmodallabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="loadmodallabel">请填入保存的数据</h4>
                    </div>
                    <div class="modal-body">
                        <textarea id="loadmodaltextarea"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button id="loadmodalbutton" type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </body>
    <script>


        $(window).scroll(function () {
            $('.wheel.active').mouseleave();
        });

        //show unitlist
        $('#initbutton').click(function () {
            unitlistvue = unitlistupdate(unitlistvue, '#unitlistdiv');
        });

        //save not welcome flag in localstorage
        $('#notwelcome').click(function () {
            if ($(this).prop('checked'))
                localStorage['notwelcome'] = 'true';
            else
                localStorage.removeItem('notwelcome');
        });
        
        //get notwelcome flag
        if (localStorage.notwelcome != undefined){
            $('#notwelcome').prop('checked', true);
        }

        //change selected when navi dropdown clicked
        $('#navidiv ul li a').click(function () {
            $(this).parents('.btn-group').find('button .navichosen').text($(this).text());
        });

        //change selected specially for #costdiv
        $('#navidiv #costdiv ul li a').click(function () {
            $(this).parents('.btn-group').find('button .navichosen').text($(this).text() != '全部' ? $(this).text()[0] : '全部');
        });

        //update unitlist
        $('#searchbutton').click(function () {
            unitlistvue = unitlistupdate(unitlistvue, '#unitlistdiv');
        });

        //show 15 random unit within current filter
        $('#randombutton').click(function () {
            israndom15 = true;
            unitlistvue = unitlistupdate(unitlistvue, '#unitlistdiv');
        });

        $('#footer .wheel-button').wheelmenu({ animation: "fade", animationSpeed: "fast", trigger: "hover" });
        
        //savedata button, set save textarea texts
        $('button#savedata').click(function () {
            $('#savemodaltextarea').val(JSON.stringify(localStorage));
        });

        //loaddata button
        $('#loadmodalbutton').click(function () {
            try{
                var data = JSON.parse($('#loadmodaltextarea').val());
                if (Object.keys(data).length == 0){
                    alert('空数据！不载了！');
                    return;
                }
                localStorage.clear();
                for (var i in data)
                    localStorage[i] = data[i];
                alert('导入成功！为更新数据将刷新网页！');
                location.reload();
            }
            catch(err){
                alert('载入错误！可在控制台查看错误信息。');
                console.log(err);
            }
        });
        
        loaddataJSON('unitdata.json');
    </script>
</html>
